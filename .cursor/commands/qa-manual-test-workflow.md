# QA 人工测试工作流（qa-manual-test-workflow）

本命令实现**两阶段**工作流：① 根据最新项目进度审查记录套用模板生成/覆盖人工测试条目文档；② 用户完成测试并反馈后，根据填写内容整理测试结果日志与修复单。

---

## 阶段 A：生成人工测试条目文档（本命令执行时）

执行本命令时，按以下步骤运行，并在对话结尾**等待用户完成测试并回复「测试完成」或「已经测试完成」**。

### A.1 读取项目进度与范围

- 阅读 **`docs/project/review_log.md`**，取**最新一条**审查记录（最后一个 `### YYYY-MM-DD` 块），得到：
  - **日期**、**阶段**（如 P0、P1 已完成 / P2 进行中等）、**进度结论**。
- 根据阶段结论，阅读对应交付清单以确认测试范围与参考文档：
  - **P0** → `docs/project/p0_deliverables.md`
  - **P1** → `docs/project/p1_deliverables.md`
  - **P2** → `docs/project/p2_deliverables.md`（若已进入或部分实现）
- 阅读 **`docs/project/project_manager.md`** 中阶段总览与各阶段目标，用于撰写「适用范围」等说明。

### A.2 套用模板生成测试条目文档

- 阅读 **`docs/qa/app_manual_test_checklist_template.md`**。
- 确定占位符替换内容（以审查记录日期与阶段为准）：
  - **{{SCOPE_DESCRIPTION}}**：根据 review_log 最新结论撰写，例如「P0 基础架设 与 P1 工具先行 已实现功能；P2 手帐核心尚未完成，手账页仅为占位」；若仅 P0 完成则只写 P0 与占位。
  - **{{PHASES_SUMMARY}}**：例如「P0 已完成、P1 已完成（截至 YYYY-MM-DD Review）」或与当前阶段一致。
  - **{{REFERENCE_DOCS}}**：列出与本轮测试范围相关的文档，如 `[P0 交付清单](../project/p0_deliverables.md)、[P1 交付清单](../project/p1_deliverables.md)、[路由规格](../technical/routes_spec.md)、[主壳规格](../design/main_shell_spec.md)`，按实际涉及阶段调整。
  - **{{REVISION_DATE}}**：使用**当前日期**（执行本命令的日期，YYYY-MM-DD）。
- **不得**修改模板中任何测试项的「通过」列：保持为 `[ ]`，以便用户在本轮测试中自行勾选。
- **问题记录表**：仅保留表头行，数据行留空或保留一行「（测试时填写；无问题可留空或删行）」。
- 将替换后的完整内容**覆盖写入** **`docs/qa/app_manual_test_checklist.md`**。

### A.3 收尾与等待用户

- 向用户汇报：
  - 已根据 **review_log 最新记录**（日期与阶段）生成并覆盖 **`docs/qa/app_manual_test_checklist.md`**。
  - 测试范围与适用阶段已按当前进度填写。
- **明确说明**：
  - 「请执行人工测试，并在该文档中：① 对每条测试项在「通过」列勾选 `[x]`（通过）、`[!]`（未通过/待优化）或 `[-]`（跳过）；② 在「问题记录表」中填写未通过项（序号、测试项、现象描述、严重程度）。」
  - 「完成后请在本对话中回复 **「测试完成」** 或 **「已经测试完成」**，我将根据您填写的内容整理测试结果日志与修复单。」

---

## 阶段 B：整理测试结果与修复单（用户回复「测试完成」时）

当用户在同一对话或后续对话中明确回复**「测试完成」**或**「已经测试完成」**（或等价表述）时，执行以下步骤。若当前对话中尚未执行过阶段 A、且 `docs/qa/app_manual_test_checklist.md` 并非本轮由模板新生成，可提示用户先执行本 command 完成阶段 A 再填写测试结果。

### B.1 读取已填写的测试条目文档

- 阅读 **`docs/qa/app_manual_test_checklist.md`**：
  - 统计所有测试项表格中「通过」列：`[x]` 数量（通过）、`[!]` 数量（未通过/待优化）、`[-]` 数量（跳过）；按模块（P0、P1、占位、回归）分别统计并汇总。
  - 提取「问题记录表」中每一行有效数据（有序号、测试项、现象描述、严重程度；已含修复单编号的行也一并记录，用于区分新旧问题）。

### B.2 追加测试结果日志

- 打开 **`docs/qa/test_result_log.md`**，在「测试结果记录」区域末尾**追加一条**新记录（`### YYYY-MM-DD`，使用当前日期）：
  - **版本/构建**：可由用户提供或写「当前工作区」。
  - **测试范围**：与本轮生成的 checklist 一致（如「P0 基础架设 + P1 工具先行 + 占位页 + 回归可选」）。
  - **结果统计**：通过数、未通过/待优化数、跳过数、合计；可简要按模块说明。
  - **结论**：根据通过率与遗留问题判断是否可发布/转测、是否有阻塞项。
  - **遗留问题**：列出未通过项；若已写入修复单则写「详见 [修复单](bug_fix_list.md)」并列出本条新增的 B-xxx 编号及简要描述与严重程度。
  - **待办**：建议的复测、修复排期或文档更新。
- 若文档末尾有「*后续每次……*」等说明，保持在其**上方**插入新记录。

### B.3 更新修复单（bug_fix_list）

- 阅读 **`docs/qa/bug_fix_list.md`**，确认编号规则与现有条目（B-{阶段}-{开发号}-{Bug序号}）。
- 对问题记录表中**未在修复单中已有编号**的每一行（即新问题）：
  - **阶段**：由测试项前缀推断（如 P1-11 → P1）。
  - **开发号**：该阶段在 bug_fix_list 中已出现的**最大开发号 + 1**（若该阶段尚无任何 Bug，则为 1）。
  - **Bug序号**：该开发号下从 001 起连续（若本批有 2 个新 Bug，则为 001、002）。
- 在 **`docs/qa/bug_fix_list.md`**「修复单列表」中按现有格式**新增**每条新 Bug：
  - 标题、关联测试项、现象描述、复现步骤、预期、严重程度、状态（待修复）、来源（本次测试日期）。
- 在「修订记录」表末尾增加一行：日期与「根据 test_result_log YYYY-MM-DD 人工测试结果，新增 B-Px-y-zzz（列表）」。

### B.4 可选：回写问题记录表中的修复单编号

- 若本轮在 bug_fix_list 中**新增**了若干条（如 B-P1-2-001、B-P1-2-002），可在 **`docs/qa/app_manual_test_checklist.md`** 的「问题记录表」中，为对应行补上「修复单编号」列链接（如 `[B-P1-2-001](bug_fix_list.md#b-p1-2-001)`），便于追溯。仅更新本轮新增的 Bug 对应行，勿改动用户已填写的其他列。

### B.5 汇报用户

- 向用户汇报：
  - 已在 **`docs/qa/test_result_log.md`** 追加一条测试结果记录（日期、统计、结论、遗留问题、待办）。
  - 已在 **`docs/qa/bug_fix_list.md`** 中为本轮新问题新增修复单（列出编号与标题）。
  - 可选：已在本轮 checklist 的问题记录表中补全修复单编号链接。
- 给出**简要摘要**：通过/未通过/跳过数量、新增 Bug 编号列表、结论与建议待办。

---

## 参考文档

| 文档 | 说明 |
|------|------|
| `docs/project/review_log.md` | 项目进度审查记录，阶段 A 依据最新一条生成范围 |
| `docs/qa/app_manual_test_checklist_template.md` | 人工测试条目模板，含占位符 |
| `docs/qa/app_manual_test_checklist.md` | 生成目标与用户填写目标 |
| `docs/qa/test_result_log.md` | 阶段 B 追加测试结果摘要 |
| `docs/qa/bug_fix_list.md` | 阶段 B 新增修复单，编号规则 B-{阶段}-{开发号}-{Bug序号} |
