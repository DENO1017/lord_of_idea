# 《灵感之主》项目管理：开发优先级与排期

本文档为项目规划开发优先级与里程碑排期，与 [项目概览](project_overview.md)、[架构指南](architecture_guide.md) 保持一致，便于按阶段交付可用的产品能力。

---

## 1. 优先级原则

- **先跑通核心闭环**：用户能「用工具 → 记进手帐 → 再看」的最小路径优先于锦上添花。
- **本地优先**：先完成本地可用的电子手帐与工具，再接入网络与共享，降低对后端的依赖与风险。
- **可演示、可验证**：每个阶段结束应有可安装、可演示的版本，便于验收与调整方向。
- **依赖前置**：手帐的「块模型」与数据层是后续占卜/骰子插入、共享与权限的基础，需提前稳定。

---

## 2. 阶段总览

| 阶段 | 名称 | 核心目标 | 建议周期（参考） |
|------|------|----------|------------------|
| **P0** | 基础架设 | 应用骨架、路由、主题、DI、基础目录与规范 | 1–2 周 |
| **P1** | 工具先行 | 骰子、诗签、简易占卜（如单张塔罗），独立使用 | 2–3 周 |
| **P2** | 手帐核心 | 本地手帐 CRUD、页/块模型、插入工具结果、基础编辑 | 3–4 周 |
| **P3** | 手帐增强 | 富文本与解读书写、装饰系统（贴纸/胶带）、视觉与导出 | 3–4 周 |
| **P4** | 共享与跑团 | 共享手帐、权限与暗骰、跑团模板、协作与同步 | 4–6 周 |
| **P5** | 打磨与发布 | 占卜学习内容、性能与体验、多端适配、上架准备 | 持续/按需 |

以下各节对每阶段做细化，并给出与架构的对应关系。

---

## 3. P0：基础架设

**目标**：搭好应用骨架与工程规范，后续功能可在此之上按 feature 增量开发。

| 项 | 内容 | 产出/验收 |
|----|------|-----------|
| 应用入口与壳 | `main.dart`、`app.dart`，主题（含基础色/字体）、多主题可选 | 启动即见统一主题 |
| 路由 | 引入 go_router，定义占位路由（如 `/`、`/tools`、`/journal`、`/journal/:id`） | 可导航到占位页 |
| 目录结构 | 按 architecture_guide 建立 `core/`、`features/`、`shared/` 及占卜/手帐/共享手帐子目录 | 新代码有明确归属 |
| 状态管理与 DI | 确定并引入 Riverpod 或 Bloc，在 core 中集中注册 | 可在任意页通过 DI 获取服务 |
| 基础设置 | 语言/主题持久化（如 shared_preferences）、l10n 占位 | 重启后设置保持 |
| 规范与质量 | 配置 lint、格式化、可选 pre-commit；README 中说明如何运行与构建 | 新人可一键跑起项目 |

**依赖**：无（首阶段）。  
**建议排期**：1–2 周。完成后可发布「空壳」内测包，用于确认架构与导航。

---

## 4. P1：工具先行

**目标**：用户能独立使用骰子、诗签、简易占卜（如单张塔罗），结果可复制或为后续「插入手帐」预留数据结构。

| 项 | 内容 | 产出/验收 |
|----|------|-----------|
| 骰子 | 支持 d4/d6/d8/d10/d12/d20 及自定义面数，支持多颗、表达式（如 2d6+3） | 可掷骰并看到结果，结果结构可序列化 |
| 诗签 | 一套可配置的诗签库，随机抽签并展示文案 | 可抽签、可换库（至少 1 套默认） |
| 简易占卜 | 单张塔罗抽取 + 正逆位 + 简明释义（本地数据） | 可抽牌并看到牌面与释义 |
| 工具入口 | 在首页或「工具」页集中入口，每个工具独立页 | 从首页可进入各工具并返回 |
| 结果数据结构 | 定义「骰子结果」「诗签结果」「占卜结果」的通用/可序列化模型（与手帐块模型对齐） | 便于 P2 插入手帐 |

**依赖**：P0 完成。  
**建议排期**：2–3 周。本阶段不要求登录与网络，全部本地即可验证。

---

## 5. P2：手帐核心

**目标**：本地电子手帐可用——创建/编辑手帐与页面，支持「块」模型，并能将 P1 的工具结果作为块插入。

| 项 | 内容 | 产出/验收 |
|----|------|-----------|
| 数据模型 | 手帐、页面、块（含类型：文本、骰子结果、占卜结果、诗签结果等），本地 DB（如 drift）建模与迁移 | 可持久化手帐结构，支持按手帐/页查询 |
| 手帐 CRUD | 创建/重命名/删除手帐，增删页，页内块顺序 | 手帐列表与页列表可管理 |
| 块编辑 | 添加文本块、从工具页「插入到当前手帐」或在手帐内调用工具并插入结果块 | 手帐内可见工具结果块并可排序 |
| 基础展示 | 手帐阅读视图：按页展示块列表，块类型不同展示方式不同 | 打开手帐即可阅读已插入内容 |
| 路由与导航 | `/journal`、`/journal/:id`、`/journal/:id/page/:pageId` 等（见 architecture_guide） | 深链可打开指定手帐/页 |

**依赖**：P0、P1；块模型需与 P1 结果结构一致或可转换。  
**建议排期**：3–4 周。完成后核心闭环成立：用工具 → 记进手帐 → 再阅读。

---

## 6. P3：手帐增强

**目标**：手帐更贴近「电子手帐」体验——富文本与解读书写、装饰系统、视觉优化与导出。

| 项 | 内容 | 产出/验收 |
|----|------|-----------|
| 富文本/解读书写 | 文本块支持富文本或扩展为「解读」区域；占卜/骰子块旁可写解读 | 用户能在结果旁写解读与笔记 |
| 装饰系统 | 贴纸、胶带等装饰类型；可添加、拖拽、缩放、与块或页关联；装饰数据纳入块/层模型 | 手帐页上可放置装饰并保存 |
| 视觉与主题 | 手帐内页样式（背景、分区线等）、与 app 主题协调 | 阅读时有明确的手帐风格 |
| 导出 | 单页或整本导出为图片/PDF（可选） | 可分享单页或备份整本 |

**依赖**：P2 完成。  
**建议排期**：3–4 周。本阶段仍为本地能力，不依赖后端。

---

## 7. P4：共享手帐与跑团支持

**目标**：支持多人共享手帐、权限控制（含暗骰与仅主持人可见）、跑团模板与协作记录。

| 项 | 内容 | 产出/验收 |
|----|------|-----------|
| 后端与认证 | 选定后端（如 Supabase/自建），实现用户注册/登录；手帐与块的服务端模型与 API | 可登录并同步「我的」手帐元数据 |
| 共享手帐 | 创建共享手帐、邀请协作者、角色（持有者/编辑/只读等） | 多人可进入同一手帐并看到一致内容（在权限内） |
| 块/页级权限 | 持有者可为块或页设置「仅自己可见」；同步时按权限过滤 | 暗骰、背景设定仅主持人可见 |
| 同步与冲突 | 离线编辑与上线后的同步策略；简单冲突处理（如最后写入或提示） | 共享手帐在多人编辑下不丢数据、权限正确 |
| 跑团模板 | 预置跑团用手帐模板（如角色卡页、回合记录页、暗骰区） | 创建手帐时可选择跑团模板 |
| 协作体验 | 当前在线者、编辑光标（可选）、通知（可选） | 至少能区分「谁在编辑」或「有更新」 |

**依赖**：P0–P3；架构中的 SyncService、权限在 domain 层的抽象需在本阶段实现。  
**建议排期**：4–6 周。建议拆为 4a（后端+认证+单用户同步）、4b（共享+权限）、4c（模板+协作体验）子迭代。

---

## 8. P5：打磨与发布

**目标**：完善内容与体验，达到可对外发布或长期维护的基线。

| 项 | 内容 | 说明 |
|----|------|------|
| 占卜学习内容 | 塔罗牌阵教学、多种占卜法说明、牌义与解读指引 | 与 P1 简易占卜区分，侧重「学习」 |
| 性能与体验 | 大手帐打开速度、列表虚拟化、动画与过渡、无障碍 | 按问题优先级排 |
| 多端适配 | 平板布局、桌面端窗口、横竖屏 | 按目标平台排期 |
| 上架与合规 | 应用商店素材、隐私政策、权限说明、版本号与发布流程 | 随发布计划推进 |

**依赖**：P4 基本可用后即可并行部分项（如占卜学习内容）。  
**建议排期**：不设固定结束时间，按「发布窗口」或「内容就绪」分批交付。

---

## 9. 排期示意（甘特式）

以下为相对顺序与大致时长，具体周数可按团队规模调整。

```
P0 基础架设           [====] 1–2 周
P1 工具先行              [======] 2–3 周  （可与 P0 末尾重叠 1 周）
P2 手帐核心                 [========] 3–4 周
P3 手帐增强                      [========] 3–4 周
P4 共享与跑团                           [============] 4–6 周
P5 打磨与发布                                    [————— 持续 —————]
```

**首个「可对外演示」节点**：P2 结束——本地手帐 + 工具结果插入。  
**首个「协作可用」节点**：P4 中段（共享 + 权限基本完成）。

---

## 10. 风险与缓冲

- **手帐块模型变更**：若 P2 后期才大改块结构，会影响 P3 装饰与 P4 同步。建议 P0/P1 末尾锁定块与结果的数据契约。
- **后端选型推迟**：P4 依赖后端与认证；可先用本地「共享手帐」模拟（同一设备多角色）做权限与 UI，再接入真实后端。
- **富文本与装饰实现成本**：若选型复杂，P3 可先做「纯文本 + 简单贴图」，装饰与富文本分两小迭代完成。

建议在每个阶段末尾留约 10–20% 时间做缓冲与技术债清理。

---

## 11. 文档与迭代

- 本文档位于 `docs/project/project_manager.md`。每次迭代或发布后，可更新「建议周期」与实际完成日期、以及「风险与缓冲」中的经验。
- 具体任务拆解建议放在 issue/看板中，本文档只保留阶段级优先级与排期，与 [project_overview](project_overview.md)、[architecture_guide](architecture_guide.md) 一起作为项目管理的单一事实来源。

---

*最后更新：初版排期与优先级，随开发进展可调整阶段边界与周期。*
