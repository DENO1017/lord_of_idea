# P3 手帐增强：交付清单与文档索引

本文档对应 [project_manager](project_manager.md) 中的 **P3：手帐增强**，列出每项交付内容、验收标准、相关文档位置，以及**需要产品填写或决策的内容**。

---

## 交付项与文档映射

| P3 交付项 | 验收标准 | 对应文档 | 需填写/决策项 |
|-----------|----------|----------|----------------|
| 富文本/解读书写 | 文本块支持富文本或扩展为「解读」区域；占卜/骰子块旁可写解读 | [富文本与解读规格](../technical/rich_text_interpretation_spec.md) | 见 § 需产品填写 |
| 装饰系统 | 贴纸、胶带等；可添加、拖拽、缩放；与块或页关联并持久化 | [装饰系统规格](../technical/decoration_spec.md) | 见 § 需产品填写 |
| 视觉与主题 | 手帐内页样式（背景、分区线等）、与 app 主题协调 | [手帐视觉与导出规格](../technical/journal_visual_export_spec.md) | 见 § 需产品填写 |
| 导出 | 单页或整本导出为图片/PDF（可选） | [手帐视觉与导出规格](../technical/journal_visual_export_spec.md) | 见 § 需产品填写 |

**任务拆解与测试用例**：见 [P3 开发任务拆解与测试用例](../development/p3_tasks_and_tests.md)。

---

## 需要产品填写的内容汇总（填写状态）

以下为 P3 中**与产品设计、体验、文案相关**的项；技术实现已按「常用、易理解、易扩展」方式在对应技术规格中给出默认方案，产品可在此处覆盖或补充。

### 富文本/解读书写 — 【待产品填写】

- **解读入口与位置**：占卜块/骰子块/诗签块的「解读」入口放在块内何处？（例如：块下方折叠区、块右侧「写解读」按钮、长按菜单「添加解读」等。）  
  - 技术默认：块下方可展开的「解读」区域，与块同属一「逻辑块」或通过 `interpretation` 字段关联，见 [富文本与解读规格](../technical/rich_text_interpretation_spec.md)。
- **富文本范围**：文本块需要哪些富文本能力？（仅加粗/斜体/下划线，还是含列表、标题层级、颜色等。）  
  - 技术默认：采用 **Markdown 子集**（加粗、斜体、行内代码）存储，展示时渲染；便于扩展为完整 Markdown 或 Delta。
- **解读是否支持富文本**：解读区域是纯文本还是与文本块一致的富文本？  
  - 技术默认：与文本块一致（同上 Markdown 子集），产品可改为纯文本或更丰富格式。
- **l10n**：新增文案的 key 与默认中文，如「添加解读」「解读」「无解读」等，见规格文档或 l10n 文件。

**落实**：产品定稿后更新 [rich_text_interpretation_spec](../technical/rich_text_interpretation_spec.md) 与本文档；实现时按定稿方案做解读入口与富文本范围。

---

### 装饰系统 — 【待产品填写】

- **装饰类型与命名**：除「贴纸」「胶带」外是否还有类型（如印章、边框）？产品侧名称与 l10n key（如 `decorationSticker`、`decorationTape`）。  
  - 技术默认：类型枚举 `sticker`、`tape`，可扩展；数据模型见 [decoration_spec](../technical/decoration_spec.md)。
- **装饰素材来源**：贴纸/胶带图片来自内置资源包、用户相册，或两者都支持？  
  - 技术默认：**内置资源**（如 `assets/decorations/stickers/`、`assets/decorations/tapes/`），ID 与文件路径一一对应；预留「用户上传」扩展点。
- **与页/块关联方式**：装饰是「挂在某一页」还是「挂在某个块旁」？  
  - 技术默认：**页级装饰**（归属 `pageId`），含位置、尺寸、旋转、zIndex，便于拖拽与导出时一起渲染；产品若需要「块级装饰」可在规格中补充。
- **默认素材数量与命名**：首版内置多少种贴纸、多少种胶带？是否有分类/标签供选择器筛选？  
  - 技术默认：各 5～10 个示例素材，ID 规则 `sticker_01`、`tape_01`；分类为可选扩展。

**落实**：产品定稿后更新 [decoration_spec](../technical/decoration_spec.md)；实现时按定稿做选择器 UI 与关联方式。

---

### 视觉与主题 — 【待产品填写】

- **手帐内页样式**：阅读/编辑时手帐页的背景样式（纯色、纹理图、分区线、边距等）。  
  - 技术默认：提供 2～3 种**内页主题**（如羊皮纸、网格线、空白），与 [theme_spec](../design/theme_spec.md) 色板协调；字段见 [journal_visual_export_spec](../technical/journal_visual_export_spec.md)。
- **内页主题与 app 主题关系**：是否跟随系统/应用亮暗色切换，还是手帐内页独立选择？  
  - 技术默认：手帐内页主题**可独立选择**（每本手帐或每页可选），不强制跟随 app 主题，便于「本子感」。
- **分区线/网格样式**：若有网格或横线，线色、间距、是否可开关？  
  - 技术默认：线色使用 `outline`/`surfaceVariant`，间距 24pt；可在内页主题中开关「显示网格」。

**落实**：产品定稿后更新 [journal_visual_export_spec](../technical/journal_visual_export_spec.md) 与 [theme_spec](../design/theme_spec.md)（若需新增语义色）；实现时按定稿提供内页主题选择与预览。

---

### 导出 — 【待产品填写】

- **导出入口**：单页/整本导出入口放在何处？（例如：手帐详情 AppBar 菜单、页内长按菜单、设置页等。）  
  - 技术默认：手帐详情页 **AppBar 菜单** 中提供「导出本页」「导出整本」；整本导出可选「当前页起」或「全部页」。
- **导出格式优先级**：首版必须支持图片（PNG）还是 PDF，或两者都要？  
  - 技术默认：**单页/整本均支持 PNG**；**整本支持 PDF**（多页合并）；图片分辨率与 DPI 见规格。
- **导出内容范围**：是否包含装饰、背景样式？  
  - 技术默认：**包含**当前内页主题背景与页上所有块、装饰，与阅读视图一致。
- **l10n**：导出相关文案，如「导出本页」「导出整本」「导出为图片」「导出为 PDF」「导出成功」等。

**落实**：产品定稿后更新 [journal_visual_export_spec](../technical/journal_visual_export_spec.md)；实现时按定稿做入口与格式。

---

## P3 完成检查

- [ ] 富文本/解读书写：文本块支持约定富文本（或纯文本兼容）；占卜/骰子/诗签块旁可写解读并持久化。
- [ ] 装饰系统：支持贴纸、胶带等类型；可添加、拖拽、缩放；装饰数据与页关联并保存。
- [ ] 视觉与主题：手帐内页至少一种背景/样式可选，与 app 主题协调。
- [ ] 导出：单页或整本可导出为图片/PDF（按产品定稿格式），内容含块与装饰。
- [ ] 所有「需产品填写」项已在本文档或对应规格中落实并定稿。

---

## 与 P2 的衔接

- P3 在 P2 块模型上**扩展**：文本块 payload 可升级为富文本结构；工具结果块可增加 `interpretation` 或通过关联「解读块」实现解读，见 [富文本与解读规格](../technical/rich_text_interpretation_spec.md)、[手帐数据模型](../technical/journal_data_models_spec.md)。
- 装饰为**页级数据**（或独立表），不改变现有块表主结构，仅增表或增列，见 [装饰系统规格](../technical/decoration_spec.md)。
- 手帐/页可增加「内页主题」「封面」等可选字段，见 [手帐视觉与导出规格](../technical/journal_visual_export_spec.md)。

---

*本文档随 P3 推进更新勾选与需填写汇总。*
